without safepoints:
https://github.com/RichardWarburton/honest-profiler
https://github.com/RichardWarburton/honest-profiler/wiki
