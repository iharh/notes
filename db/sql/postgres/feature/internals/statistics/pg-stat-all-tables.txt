*********************************************************************************************
–ù–∞–ø—Ä–∏–º–µ—Ä, —Å –ø–æ–º–æ—â—å—é –≤–æ—Ç —Ç–∞–∫–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ –º—ã –º–æ–∂–µ–º –Ω–∞–π—Ç–∏ —Ç–æ–ø 5 —Ç–∞–±–ª–∏—Ü, –ø–æ –∫–æ—Ç–æ—Ä—ã–º —á–∞—â–µ –≤—Å–µ–≥–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ:

SELECT
    schemaname, relname,
    seq_scan, seq_tup_read,
    seq_tup_read / seq_scan as avg_seq_tup_read
FROM pg_stat_all_tables
WHERE seq_scan > 0
ORDER BY 5 DESC LIMIT 5;

–ó–Ω–∞—è, –∫–∞–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –∫ —Ç–∞–∫–∏–º —Ç–∞–±–ª–∏—Ü–∞–º, –º–æ–∂–Ω–æ –≤—ã—á–∏—Å–ª–∏—Ç—å –Ω–µ–æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å.

–ï—Å–ª–∏ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã –Ω–µ –¥–∞–ª–∏ –Ω–∏ –∫–∞–∫–∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∏ —É –≤–∞—Å –≤—Å–µ —Ö–æ—Ä–æ—à–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ, 
—Ç–æ –ø–æ–¥—Å–∫–∞–∑—É –º–æ–∂–µ—Ç –¥–∞—Ç—å –∫–æ–ª–æ–Ω–∫–∞ calls¬†–≤ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–∏¬†pg_stat_statements. 
–≠—Ç–∞ –∫–æ–ª–æ–Ω–∫–∞ –ø–æ–∫–∞–∂–µ—Ç –∫–∞–∫ —á–∞—Å—Ç–æ –≤—ã–∑—ã–≤–∞–ª—Å—è –∑–∞–ø—Ä–æ—Å. 
–ú–æ–∂–µ—Ç —Å–ª—É—á–∏—Ç—Å—è —Ç–∞–∫, —á—Ç–æ –∑–∞–ø—Ä–æ—Å –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Å–ª–∏—à–∫–æ–º —á–∞—Å—Ç–æ –∏–∑-–∑–∞ –∫–∞–∫–∏—Ö-—Ç–æ —Å–±–æ–µ–≤ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∏–ª–∏ –Ω–µ–æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–≥–æ –∫–æ–¥–∞, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ —Å–∏–ª—å–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–µ CPU
*********************************************************************************************
–ï—Å–ª–∏ –º—ã —Ö–æ—Ç–∏–º, —á—Ç–æ–±—ã –Ω–∞—à–∞ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Ä–∞–±–æ—Ç–∞–ª–∞ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ, —Ç–æ –∑–∞ –Ω–µ–π –Ω—É–∂–Ω–æ —Å–ª–µ–¥–∏—Ç—å, –≤—ã—è–≤–ª—è—Ç—å –Ω–µ–æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∏ —Ä–∞–∑–ª–∏—á–Ω—ã–µ –∞–Ω–æ–º–∞–ª–∏–∏.
–í —ç—Ç–æ–º –Ω–∞–º –∏ –ø–æ–º–æ–∂–µ—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ pg_stat_all_tables.

pg_stat_all_tables –ø–æ–∫–∞–∂–µ—Ç –Ω–∞–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –≤—Å–µ–º —Ç–∞–±–ª–∏—Ü–∞–º –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (—Å–∏—Å—Ç–µ–º–Ω—ã–º –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º), –ø–æ–∫–∞–∂–µ—Ç –∫–æ–ª-–≤–æ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö –∏ –∏–Ω–¥–µ–∫—Å–Ω—ã—Ö —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–π, 
–æ–ø–µ—Ä–∞—Ü–∏–π –ø–æ —É–¥–∞–ª–µ–Ω–∏—é, –æ–±–Ω–æ–≤–ª–µ–Ω–∏—é –∏ –≤—Å—Ç–∞–≤–∫–∏ —Å—Ç—Ä–æ–∫, –∞ —Ç–∞–∫–∂–µ –∫–æ–ª-–≤–æ "–º–µ—Ä—Ç–≤—ã—Ö" —Å—Ç—Ä–æ–∫ –∏ —Å—Ç–∞—Ç—É—Å –æ–ø–µ—Ä–∞—Ü–∏–π VACUUM –∏ ANALYZE. –ö–æ—Ä–æ—á–µ –æ—á–µ–Ω—å –ø–æ–ª–µ–∑–Ω–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ ü§ì

–î–∞–≤–∞–π—Ç–µ —Ä–∞—Å—Å–º–æ—Ç—Ä–∏–º –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ–ª–µ–∑–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ —ç—Ç–æ–º—É –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—é.

‚úÖ –°–º–æ—Ç—Ä–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–ø–µ—Ä–∞—Ü–∏–π –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–≥–æ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Ç–∞–±–ª–∏—Ü:

SELECT
schemaname,
relname,
seq_scan,
idx_scan,
seq_tup_read,
seq_tup_read / seq_scan as avg_seq_read
FROM
pg_stat_all_tables
WHERE
seq_scan > 0
AND
schemaname not in ('pg_catalog','information_schema','pg_toast')
ORDER BY
avg_seq_read DESC
LIMIT 10;

–≠—Ç–æ—Ç –∑–∞–ø—Ä–æ—Å –ø–æ–∫–∞–∂–µ—Ç —Ç–æ–ø 10 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Ç–∞–±–ª–∏—Ü, –ø–æ –∫–æ—Ç–æ—Ä—ã–º –±—ã–ª–æ –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ –æ–ø–µ—Ä–∞—Ü–∏–π –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–≥–æ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è.

‚úÖ –ù–∞—Ö–æ–¥–∏–º –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∏–ª–∏ —Ä–µ–¥–∫–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ç–∞–±–ª–∏—Ü—ã:

SELECT
schemaname,
relname,
seq_scan,
idx_scan,
(COALESCE(seq_scan, 0) + COALESCE(idx_scan, 0)) as total_scans_performed
FROM
pg_stat_all_tables
WHERE
(COALESCE(seq_scan, 0) + COALESCE(idx_scan, 0)) < 10
AND schemaname not in ('pg_catalog', 'information_schema', 'pg_toast')
ORDER BY
5 DESC;

–ó–∞–ø—Ä–æ—Å –ø–æ–∫–∞–∂–µ—Ç —Ç–∞–±–ª–∏—Ü—ã, —É –∫–æ—Ç–æ—Ä—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–≥–æ –∏ –∏–Ω–¥–µ–∫—Å–Ω–æ–≥–æ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–µ –ø—Ä–µ–≤—ã—à–∞–ª–∏ –∫–æ–ª-–≤–∞ 10—Ç—å.

‚úÖ –°–º–æ—Ç—Ä–∏–º –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–π –∑–∞–ø–∏—Å–∏ –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º —Ç–∞–±–ª–∏—Ü–∞–º:

SELECT
st.schemaname,st.relname,
pg_size_pretty(pg_total_relation_size(st.relid)) as Total_Size,
st.seq_scan,
st.idx_scan,
st.n_tup_ins,
st.n_tup_upd,
st.n_tup_del
FROM pg_stat_all_tables st
WHERE st.schemaname not in ('pg_catalog','information_schema','pg_toast')
ORDER BY Total_Size DESC;

–ó–∞–ø—Ä–æ—Å –ø–æ–∫–∞–∂–µ—Ç –∫–æ–ª-–≤–æ –æ–ø–µ—Ä–∞—Ü–∏–π –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–≥–æ –∏ –∏–Ω–¥–µ–∫—Å–Ω–æ–≥–æ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ —Ç–∞–±–ª–∏—Ü–∞–º, –∞ —Ç–∞–∫–∂–µ –∫–æ–ª-–≤–æ –æ–ø–µ—Ä–∞—Ü–∏–π –≤—Å—Ç–∞–≤–∫–∏, —É–¥–∞–ª–µ–Ω–∏—è –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç—Ä–æ–∫ —Ç–∞–±–ª–∏—Ü.

‚úÖ –°–º–æ—Ç—Ä–∏–º –∫–æ–ª-–≤–æ "–∂–∏–≤—ã—Ö" –∏ "–º–µ—Ä—Ç–≤—ã—Ö" —Å—Ç—Ä–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Ç–∞–±–ª–∏—Ü –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å VACUUM:

SELECT
schemaname,
relname,
n_live_tup,
n_dead_tup,
n_dead_tup * 100 / (case when n_live_tup > 0 then n_live_tup else 1 end) as dead_rows_percent,
last_autovacuum,
last_autoanalyze,
n_dead_tup,
relname
FROM
pg_stat_all_tables
WHERE
schemaname not in ('pg_catalog','information_schema','pg_toast')
ORDER BY
n_dead_tup DESC;

–ó–∞–ø—Ä–æ—Å –ø–æ–∫–∞–∂–µ—Ç –∫–æ–ª-–≤–æ "–º–µ—Ä—Ç–≤—ã—Ö" —Å—Ç—Ä–æ–∫ –Ω–∞ —Ç–∞–±–ª–∏—Ü–∞—Ö, –∞ —Ç–∞–∫–∂–µ –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –ø—Ä–∏—Ö–æ–¥–∞ AUTOVACUUM –≤ —Ç–∞–±–ª–∏—Ü—É.

–ö–∞–∫ –≤–∏–¥–∏—Ç–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ pg_stat_all_tables –æ—á–µ–Ω—å –ø–æ–ª–µ–∑–Ω–æ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Ç–∞–±–ª–∏—Ü –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö PostgreSQL. 
–ö–æ–Ω–µ—á–Ω–æ —ç—Ç–æ –Ω–µ –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –ø–æ–ª–µ–∑–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ —ç—Ç–æ–º—É –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—é, –≤ –±—É–¥—É—â–∏—Ö –ø–æ—Å—Ç–∞—Ö –±—É–¥–µ–º –ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –∏ –¥—Ä—É–≥–∏–µ –∑–∞–ø—Ä–æ—Å—ã, 
–∫–æ—Ç–æ—Ä—ã–µ —Å–º–æ–≥—É—Ç –Ω–∞ –ø–æ–º–æ—á—å –≤ –¥–µ–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ PostgreSQL üßê
