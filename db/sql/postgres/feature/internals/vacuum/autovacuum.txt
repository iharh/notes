–î—É–º–∞—é, –≤–∞–º –Ω–µ —Å—Ç–æ–∏—Ç –Ω–∞–ø–æ–º–∏–Ω–∞—Ç—å –≤–∞–∂–Ω–æ—Å—Ç—å –ø—Ä–æ—Ü–µ—Å—Å–∞ AUTOVACUUM –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è PostgreSQL? üòâ –ü–æ —ç—Ç–æ–º—É —Ä–µ—à–∏–ª–∏ —Å–¥–µ–ª–∞—Ç—å –Ω–µ–±–æ–ª—å—à—É—é —à–ø–∞—Ä–≥–∞–ª–∫—É –ø–æ –µ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º, —á—Ç–æ–±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ –±—ã—Å—Ç—Ä–æ –≤—Å–ø–æ–º–Ω–∏—Ç—å –∫–∞–∫–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä –∑–∞ —á—Ç–æ –æ—Ç–≤–µ—á–∞–µ—Ç.

üìå autovacuum_max_workers

–ö–æ–ª-–≤–æ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ AUTOVACUUM (–Ω–µ —Å—á–∏—Ç–∞—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞). –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 3. –≠—Ç–æ –∑–Ω–∞—á–∏—Ç, —á—Ç–æ 3 –ø—Ä–æ—Ü–µ—Å—Å–∞ autovacuum –±—É–¥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞–¥ –æ—á–∏—Å—Ç–∫–æ–π —Ç–∞–±–ª–∏—Ü –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ. –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ —Ç—Ä–µ–±—É–µ—Ç –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ —Å–ª—É–∂–±—ã PostgreSQL. –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –ø—Ä–∏–±–ª–∏–∂–µ–Ω–∏–∏ –º–æ–∂–Ω–æ –ø–æ—Å—Ç–∞–≤–∏—Ç—å –∫–æ–ª-–≤–æ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ AUTOVACUUM —Ä–∞–≤–Ω—ã–º –ø–æ–ª–æ–≤–∏–Ω–µ –∫–æ–ª-–≤–∞ —è–¥–µ—Ä –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞.

üìå autovacuum_vacuum_cost_limit

–ü—Ä–µ–¥—ã–¥—É—â–∏–π –ø–∞—Ä–∞–º–µ—Ç—Ä –Ω–µ –∏–º–µ–µ—Ç —Å–º—ã—Å–ª–∞ —É–≤–µ–ª–∏—á–∏–≤–∞—Ç—å –±–µ–∑ —É–≤–µ–ª–∏—á–µ–Ω–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ autovacuum_vacuum_cost_limit. –û–± —ç—Ç–æ–º –º—ã —É–∂–µ –ø–∏—Å–∞–ª–∏ (https://t.me/pg_guru/195). –ù–∞–ø–æ–º–Ω—é, —ç—Ç–æ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —Å—Ç–æ–∏–º–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã –ø—Ä–æ—Ü–µ—Å—Å–∞ AUTOVACUUM –≤ —É—Å–ª–æ–≤–Ω—ã—Ö –ø–æ–ø—É–≥–∞—è—Ö. –ï—Å–ª–∏ –º—ã —É–≤–µ–ª–∏—á–∏–º –∫–æ–ª-–≤–æ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –Ω–µ —É–≤–µ–ª–∏—á–∏–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, —Ç–æ –Ω–∞—à–∏ –ø—Ä–æ—Ü–µ—Å—Å—ã –±—É–¥—É—Ç –±—ã—Å—Ç—Ä–æ –≤—ã—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –µ–µ –∏ –∑–∞—Å—ã–ø–∞—Ç—å, —á—Ç–æ –Ω–µ –ø—Ä–∏–≤–µ–¥–µ—Ç –∫ –ª—É—á—à–µ–π —Ä–∞–±–æ—Ç–µ AUTOVACUUM.

üìå autovacuum_vacuum_cost_delay

–¢–∞–π–º–∞—É—Ç —Ä–∞–±–æ—Ç—ã –ø—Ä–æ—Ü–µ—Å—Å–∞ AUTOVACUUM –ø–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ –µ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å—ã –≤—ã—Ä–∞–±–æ—Ç–∞–ª–∏ —Å–≤–æ—é —Å—Ç–æ–∏–º–æ—Å—Ç—å (–ø–æ–ª—É—á–∏–ª–∏ –∑–∞—Ä–ø–ª–∞—Ç—É üòÅ). –ù—É–∂–µ–Ω –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã —Å–∏—Å—Ç–µ–º–∞ –º–æ–≥–ª–∞ "–ø—Ä–æ–¥—ã—à–∞—Ç—å—Å—è", –∞ –Ω–µ –±—ã—Ç—å –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –∑–∞–Ω—è—Ç–æ–π –æ—á–∏—Å—Ç–∫–æ–π —Ç–∞–±–ª–∏—Ü. –ï—Å–ª–∏ –∑–∞–¥–∞–≤–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ —ç—Ç–æ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ –±–µ–∑ –µ–¥–∏–Ω–∏—Ü –∏–∑–º–µ—Ä–µ–Ω–∏—è, —Ç–æ –æ–Ω–æ —Å—á–∏—Ç–∞–µ—Ç—Å—è –∑–∞–¥–∞–Ω–Ω—ã–º –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö. –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 2 –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥—ã.

üìå autovacuum_naptime

–ó–∞–¥–∞–µ—Ç –≤—Ä–µ–º—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–µ–º–æ–Ω–æ–º –∞–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∏ –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç –Ω–∞–¥–æ–±–Ω–æ—Å—Ç–∏ –∑–∞–ø—É—Å–∫–∞ AUTOVACUUM –¥–ª—è —Ç–∞–±–ª–∏—Ü –±–∞–∑—ã. –ï—Å–ª–∏ –¥–ª—è –∑–Ω–∞—á–µ–Ω–∏—è –Ω–µ –∑–∞–¥–∞–Ω–∞ –µ–¥–∏–Ω–∏—Ü–∞ –∏–∑–º–µ—Ä–µ–Ω–∏—è, —Ç–æ –æ–Ω–æ —Å—á–∏—Ç–∞–µ—Ç—Å—è –∑–∞–¥–∞–Ω–Ω—ã–º –≤ —Å–µ–∫—É–Ω–¥–∞—Ö. –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 1 –º–∏–Ω—É—Ç–∞. –î–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–ª—É–∂–±—ã PostgreSQL.

üìå autovacuum_vacuum_threshold

–ö–æ–ª-–≤–æ –∏–∑–º–µ–Ω–µ–Ω–Ω—ã—Ö –∏–ª–∏ —É–¥–∞–ª–µ–Ω–Ω—ã—Ö —Å—Ç—Ä–æ–∫, –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–º —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç AUTOVACUUM. –ü–∞—Ä–∞–º–µ—Ç—Ä –º–æ–∂–µ—Ç –±—ã—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∫–∞–∫ –≥–ª–æ–±–∞–ª—å–Ω–æ –≤ —Ñ–∞–π–ª–µ postgresql.conf, —Ç–∞–∫ –∏ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ –¥–ª—è –æ—Ç–¥–µ–ª—å–Ω–æ –≤–∑—è—Ç–æ–π —Ç–∞–±–ª–∏—Ü—ã. –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 50.

üìå autovacuum_vacuum_scale_factor

–≠—Ç–æ –ø—Ä–æ—Ü–µ–Ω—Ç –æ—Ç –æ–±—â–µ–≥–æ –∫–æ–ª-–≤–∞ —Å—Ç—Ä–æ–∫ —Ç–∞–±–ª–∏—Ü—ã, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –∫ –ø–∞—Ä–∞–º–µ—Ç—Ä—É autovacuum_vacuum_threshold. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é 0.2 (20%). –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º –ø–æ–ª—É—á–∞–µ—Ç—Å—è, —á—Ç–æ –ø–æ—Ä–æ–≥–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∫–æ–ª-–≤–∞ —Å—Ç—Ä–æ–∫, –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–º —Å—Ä–∞–±–æ—Ç–∞–µ—Ç AUTOVACUUM –Ω–∞ —Ç–∞–±–ª–∏—Ü—É —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –ø–æ —Ñ–æ—Ä–º—É–ª–µ:

vacuum_threshold = autovacuum_vacuum_threshold + autovacuum_vacuum_scale_factor * –æ–±—â–µ–µ_–∫–æ–ª-–≤–æ_—Å—Ç—Ä–æ–∫_—Ç–∞–±–ª–∏—Ü—ã

–ï—Å–ª–∏ –≤–∞–º –ø–æ –∫–∞–∫–æ–π-—Ç–æ –ø—Ä–∏—á–∏–Ω–µ –Ω—É–∂–Ω–æ —á—Ç–æ–±—ã AUTOVACUUM —Å—Ä–∞–±–æ—Ç–∞–ª –Ω–∞ —Ç–æ—á–Ω–æ–º –∫–æ–ª-–≤–µ —Å—Ç—Ä–æ–∫ —Ç–∞–±–ª–∏—Ü—ã, –≤—ã –º–æ–∂–µ—Ç–µ –ø–æ—Å—Ç–∞–≤–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ autovacuum_vacuum_scale_factor —Ä–∞–≤–Ω—ã–º –Ω—É–ª—é –∏ –≤—ã—Å—Ç–∞–≤–∏—Ç—å –∫–æ–ª-–≤–æ —Å—Ç—Ä–æ–∫ –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä–µ  autovacuum_vacuum_threshold.

üìå autovacuum_vacuum_insert_threshold

–≠—Ç–æ –∫–æ–ª-–≤–æ –≤—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã—Ö (INSERT) —Å—Ç—Ä–æ–∫, –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–º —Å—Ä–∞–±–æ—Ç–∞–µ—Ç AUTOVACUUM –Ω–∞ —Ç–∞–±–ª–∏—Ü–µ. –≠—Ç–æ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä –ø–æ—è–≤–∏–ª—Å—è —Å –≤–µ—Ä—Å–∏–∏ PostgreSQL 13. –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 1 000 —Å—Ç—Ä–æ–∫. –ï—Å–ª–∏ –ø–æ—Å—Ç–∞–≤–∏—Ç—å -1, —Ç–æ VACUUM –Ω–µ –±—É–¥–µ—Ç —Å—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –ø—Ä–∏ –≤—Å—Ç–∞–≤–∫–µ —Å—Ç—Ä–æ–∫. –≠—Ç–æ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä –º–æ–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≥–ª–æ–±–∞–ª—å–Ω–æ –∏–ª–∏ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã.

üìå autovacuum_vacuum_insert_scale_factor

–¢–æ–∂–µ —Å–∞–º–æ–µ, —á—Ç–æ –∏ autovacuum_vacuum_scale_factor, –Ω–æ –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π –≤—Å—Ç–∞–≤–∫–∏ (INSERT). –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é - 0.2 (20%).

üìå autovacuum_analyze_scale_factor –∏ autovacuum_analyze_scale_factor

–ó–¥–µ—Å—å —Å–º—ã—Å–ª —Ç–∞–∫–æ–π –∂–µ –∫–∞–∫ —É –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤, —Ç–æ–ª—å–∫–æ –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–∏ ANALYZE.

–≠—Ç–æ –æ—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ä—ã –ø—Ä–æ—Ü–µ—Å—Å–∞ AUTOVACUUM, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–∑–≤–æ–ª—è—Ç –≤–∞–º –ø–æ–≤–ª–∏—è—Ç—å –Ω–∞ –µ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏–µ, —Å–¥–µ–ª–∞—Ç—å –µ–≥–æ —Ä–∞–±–æ—Ç—É –±–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–π, –∏–ª–∏ –Ω–∞–æ–±–æ—Ä–æ—Ç —É–º–µ–Ω—å—à–∏—Ç—å –≤–ª–∏—è–Ω–∏–µ AUTOVACUUM –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —ç—Ç–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Ç—Ä–µ–±—É–µ—Ç –∞–Ω–∞–ª–∏–∑–∞ —Ç–∞–±–ª–∏—Ü –≤–∞—à–µ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ PostgreSQL.

‚ö†Ô∏è –ó–∞ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–π —Ä–∞–±–æ—Ç–æ–π –ø—Ä–æ—Ü–µ—Å—Å–∞ AUTOVACUUM –æ—á–µ–Ω—å –≤–∞–∂–Ω–æ —Å–ª–µ–¥–∏—Ç—å, —á—Ç–æ–±—ã –≤ –∫–æ–Ω–µ—á–Ω–æ–º —Å—á–µ—Ç–µ –Ω–µ –Ω–∞—Ä–≤–∞—Ç—å—Å—è –Ω–∞ Transaction ID Wraparound, –æ –∫–æ—Ç–æ—Ä–æ–º –º—ã —É–∂–µ –ø–∏—Å–∞–ª–∏. (https://t.me/pg_guru/265)
