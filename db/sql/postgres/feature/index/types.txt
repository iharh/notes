************************************************************************************************************
‚úÖ –í –ø—Ä–µ–¥—ã–¥—É—â–µ–º –ø–æ—Å—Ç–µ –º—ã –ø–µ—Ä–µ—á–∏—Å–ª–∏–ª–∏ –∫–∞–∫–∏–µ –∏–Ω–¥–µ–∫—Å—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç PostgreSQL (https://t.me/pg_guru/724), —Ä–∞—Å—Å–º–æ—Ç—Ä–∏–º –∏–Ω–¥–µ–∫—Å BRIN –ø–æ–¥—Ä–æ–±–Ω–µ–µ.

BRIN (Block Range INdex) ‚Äî —ç—Ç–æ —Ç–∏–ø –∏–Ω–¥–µ–∫—Å–∞ –≤ PostgreSQL, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –æ—á–µ–Ω—å –±–æ–ª—å—à–∏–º–∏ —Ç–∞–±–ª–∏—Ü–∞–º–∏, –≥–¥–µ –¥–∞–Ω–Ω—ã–µ –∏–º–µ—é—Ç –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫, –Ω–∞–ø—Ä–∏–º–µ—Ä, –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ä—è–¥—ã.

‚úÖ BRIN –∏–Ω–¥–µ–∫—Å—ã –±—ã–ª–∏ –≤–≤–µ–¥–µ–Ω—ã –≤ PostgreSQL –≤ –≤–µ—Ä—Å–∏–∏ 9.5. –û—Å–Ω–æ–≤–Ω—ã–º —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–º, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–µ–¥–ª–æ–∂–∏–ª –∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–ª BRIN –∏–Ω–¥–µ–∫—Å—ã, —è–≤–ª—è–µ—Ç—Å—è –ê–ª—å–≤–∞—Ä–æ –≠—Ä—Ä–µ—Ä–∞ (Alvaro Herrera). –û–Ω —Ä–∞–±–æ—Ç–∞–ª –≤ —Å–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤–µ —Å –¥—Ä—É–≥–∏–º–∏ —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏ —Å–æ–æ–±—â–µ—Å—Ç–≤–∞ PostgreSQL, —á—Ç–æ–±—ã –≤–Ω–µ–¥—Ä–∏—Ç—å —ç—Ç—É –∏–Ω–Ω–æ–≤–∞—Ü–∏—é.

BRIN –∏–Ω–¥–µ–∫—Å—ã —ç–∫–æ–Ω–æ–º–∏—á–Ω—ã –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –¥–∏—Å–∫–æ–≤–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ –∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—Ç —Ö–æ—Ä–æ—à–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö —Ç–∏–ø–æ–≤ –∑–∞–ø—Ä–æ—Å–æ–≤.

‚úÖ –û—Å–Ω–æ–≤–Ω—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –∏ –ø—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã BRIN –∏–Ω–¥–µ–∫—Å–æ–≤:

–î–∏–∞–ø–∞–∑–æ–Ω—ã –±–ª–æ–∫–æ–≤:

BRIN –∏–Ω–¥–µ–∫—Å—ã –∏–Ω–¥–µ–∫—Å–∏—Ä—É—é—Ç –¥–∞–Ω–Ω—ã–µ –Ω–∞ —É—Ä–æ–≤–Ω–µ –±–ª–æ–∫–æ–≤ —Ç–∞–±–ª–∏—Ü—ã, –∞ –Ω–µ –Ω–∞ —É—Ä–æ–≤–Ω–µ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Å—Ç—Ä–æ–∫.

–•—Ä–∞–Ω—è—Ç –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –±–ª–æ–∫–∞ –¥–∞–Ω–Ω—ã—Ö.

–ë–ª–æ–∫ - —ç—Ç–æ –±–∞–∑–æ–≤–∞—è –µ–¥–∏–Ω–∏—Ü–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö Postgres, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –æ–Ω —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç 8 –ö–ë –¥–∞–Ω–Ω—ã—Ö. BRIN –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç –≤—ã–±–æ—Ä–∫—É –¥–∏–∞–ø–∞–∑–æ–Ω–∞ –±–ª–æ–∫–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 128), —Å–æ—Ö—Ä–∞–Ω—è—è –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –ø–µ—Ä–≤–æ–≥–æ –±–ª–æ–∫–∞ –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ, –∞ —Ç–∞–∫–∂–µ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –≤—Å–µ—Ö –∑–Ω–∞—á–µ–Ω–∏–π –≤ —ç—Ç–∏—Ö –±–ª–æ–∫–∞—Ö.

–≠–∫–æ–Ω–æ–º–∏—á–Ω–æ—Å—Ç—å –ø–æ –¥–∏—Å–∫–æ–≤–æ–º—É –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤—É:

‚úÖ BRIN –∏–Ω–¥–µ–∫—Å—ã –∑–∞–Ω–∏–º–∞—é—Ç –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –º–µ–Ω—å—à–µ –º–µ—Å—Ç–∞ –Ω–∞ –¥–∏—Å–∫–µ –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å B-tree –∏ –¥—Ä—É–≥–∏–º–∏ —Ç–∏–ø–∞–º–∏ –∏–Ω–¥–µ–∫—Å–æ–≤, –ø–æ—Ç–æ–º—É —á—Ç–æ –æ–Ω–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Ç–æ–ª—å–∫–æ –¥–ª—è –±–ª–æ–∫–æ–≤, –∞ –Ω–µ –¥–ª—è –∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ–∫–∏.

–û–ø—Ç–∏–º–∞–ª—å–Ω—ã –¥–ª—è —É–ø–æ—Ä—è–¥–æ—á–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:

‚úÖ BRIN –∏–Ω–¥–µ–∫—Å—ã —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã, –∫–æ–≥–¥–∞ –¥–∞–Ω–Ω—ã–µ –∏–º–µ—é—Ç –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –∏–ª–∏ –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–æ–≤–∞–Ω—ã. –ù–∞–ø—Ä–∏–º–µ—Ä, –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏ –≤ –∂—É—Ä–Ω–∞–ª–µ —Å–æ–±—ã—Ç–∏–π, –¥–∞–Ω–Ω—ã–µ –æ –≤—Ä–µ–º–µ–Ω–∏ –∏–ª–∏ –∏–∑–º–µ—Ä–µ–Ω–∏—è—Ö.

‚úÖ –ü—Ä–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –∏–Ω–¥–µ–∫—Å BRIN —Å—ç–∫–æ–Ω–æ–º–∏—Ç –±–æ–ª–µ–µ 99% –¥–∏—Å–∫–æ–≤–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞.

–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è BRIN –∏–Ω–¥–µ–∫—Å–æ–≤

üìå –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã

CREATE TABLE measurements ( id SERIAL PRIMARY KEY, sensor_id INT, temperature FLOAT, timestamp TIMESTAMP );¬†

üìå –í—Å—Ç–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö

INSERT INTO measurements (sensor_id, temperature, timestamp) VALUES (1, 23.5, '2024-05-29 10:00:00'), (1, 24.0, '2024-05-29 10:01:00'), -- –º–Ω–æ–∂–µ—Å—Ç–≤–æ –¥—Ä—É–≥–∏—Ö –∑–∞–ø–∏—Å–µ–π (1, 22.0, '2024-05-29 12:00:00');¬†

üìå –°–æ–∑–¥–∞–Ω–∏–µ BRIN –∏–Ω–¥–µ–∫—Å–∞

–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ BRIN –∏–Ω–¥–µ–∫—Å–∞ —Å–ª–µ–¥—É–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å, –≤–∫–ª—é—á–∞—è —É–∫–∞–∑–∞–Ω–∏–µ —Ç–∏–ø–∞ –∏–Ω–¥–µ–∫—Å–∞ –∏ –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–≥–æ —Å—Ç–æ–ª–±—Ü–∞.

CREATE INDEX measurements_brin_idx ON measurements USING BRIN (timestamp);¬†

–≠—Ç–æ—Ç –∏–Ω–¥–µ–∫—Å –±—É–¥–µ—Ç —Ö—Ä–∞–Ω–∏—Ç—å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è timestamp –≤ –∫–∞–∂–¥–æ–º –±–ª–æ–∫–µ –¥–∞–Ω–Ω—ã—Ö.

–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏—Ö BRIN –∏–Ω–¥–µ–∫—Å

üìå –ü–æ–∏—Å–∫ –ø–æ –¥–∏–∞–ø–∞–∑–æ–Ω—É –≤—Ä–µ–º–µ–Ω–∏

SELECT * FROM measurements WHERE timestamp BETWEEN '2024-05-29 10:00:00' AND '2024-05-29 11:00:00';¬†

‚úÖ –≠—Ç–æ—Ç –∑–∞–ø—Ä–æ—Å –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å BRIN –∏–Ω–¥–µ–∫—Å –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –±–ª–æ–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö, —Å–æ–¥–µ—Ä–∂–∞—â–∏—Ö –Ω—É–∂–Ω—ã–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏.

‚úÖ –û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ BRIN –∏–Ω–¥–µ–∫—Å–æ–≤ –≤–∫–ª—é—á–∞–µ—Ç –≤ —Å–µ–±—è —Ä–µ–≥—É–ª—è—Ä–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥ VACUUM –∏ ANALYZE, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã REINDEX –¥–ª—è –ø–µ—Ä–µ—Å—Ç—Ä–æ–π–∫–∏ –∏–Ω–¥–µ–∫—Å–æ–≤ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏, –Ω–∞—Å—Ç—Ä–æ–π–∫—É –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ autovacuum, –∏ —Å–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤ –Ω–∞ —É–ø–æ—Ä—è–¥–æ—á–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö. 

‚úÖ –≠—Ç–∏ –ø—Ä–∞–∫—Ç–∏–∫–∏ –ø–æ–º–æ–≥—É—Ç –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –≤—ã—Å–æ–∫—É—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å BRIN –∏–Ω–¥–µ–∫—Å–æ–≤ –≤ PostgreSQL. –û–¥–Ω–∞–∫–æ, –∫–∞–∫ –∏ –≤—Å–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã, –æ–Ω–∏ –¥–æ–ª–∂–Ω—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö —Å—Ü–µ–Ω–∞—Ä–∏—è—Ö, –≥–¥–µ –∏—Ö –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –º–æ–≥—É—Ç –±—ã—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã.
